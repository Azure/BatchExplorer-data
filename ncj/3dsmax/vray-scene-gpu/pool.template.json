{
   "parameters":{
      "poolName":{
         "type":"string",
         "metadata":{
            "description":"Id of the pool"
         }
      },
      "numberNodes":{
         "type":"int",
         "defaultValue":1,
         "metadata":{
            "description":"The number of nodes in the Azure Batch pool where the job will run"
         }
      },
      "vmSize":{
         "type":"string",
         "metadata":{
            "description":"The size of the virtual machines that run the application"
         },
         "defaultValue":"Standard_NC12",
         "allowedValues":[
            "Standard_NC6",
            "Standard_NC12",
            "Standard_NC24",
            "Standard_NC24r"
         ]
      }
   },
   "variables":{
      "osType":{
         "imageReference":{
            "publisher":"batch",
            "offer":"rendering-windows2016",
            "sku":"rendering",
            "version":"latest"
         },
         "nodeAgentSKUId":"batch.node.windows amd64"
      }
   },
   "pool":{
      "id":"[parameters('poolName')]",
      "displayName":"3ds Max pool running: [parameters('poolName')]",
      "vmSize":"[parameters('vmSize')]",
      "virtualMachineConfiguration":"[variables('osType')]",
      "targetDedicatedNodes":"[parameters('numberNodes')]",
      "applicationLicenses":[
         "3dsmax",
         "vray"
      ],
      "enableAutoScale":false,
      "enableInterNodeCommunication":true,
      "startTask":{
            "commandLine":"cmd.exe /c install-azure-nc-drivers.cmd",
            "waitForSuccess":true,
            "maxTaskRetryCount":0,
            "userIdentity":{
               "autoUser":{
                  "elevationLevel":"admin"
               }
            },
            "resourceFiles": [
              {
                "blobSource":"https://raw.githubusercontent.com/Azure/BatchLabs-data/master/ncj/3dsmax/vray-scene-gpu/install-azure-nc-drivers.cmd",
                "filePath":"install-azure-nc-drivers.cmd"
              }
            ]
      }
   }
}